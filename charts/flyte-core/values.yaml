# ---------------------------------------------------------------------
# Core System settings
# This section consists of Core components of Flyte and their deployment
# settings. This includes FlyteAdmin service, Datacatalog, FlytePropeller and
# Flyteconsole
# ---------------------------------------------------------------------

#
# FLYTEADMIN SETTINGS
#

flyteadmin:
  enabled: true
  # -- Replicas count for Flyteadmin deployment
  replicaCount: 1
  image:
    # -- Docker image for Flyteadmin deployment
    repository: cr.flyte.org/flyteorg/flyteadmin  # FLYTEADMIN_IMAGE
    tag: v1.12.1-rc0  # FLYTEADMIN_TAG
    pullPolicy: IfNotPresent
  # -- Additional flyteadmin container environment variables
  #
  # e.g. SendGrid's API key
  #  - name: SENDGRID_API_KEY
  #    value: "<your sendgrid api key>"
  #
  # e.g. secret environment variable (you can combine it with .additionalVolumes):
  # - name: SENDGRID_API_KEY
  #   valueFrom:
  #     secretKeyRef:
  #       name: sendgrid-secret
  #       key: api_key
  env: []
  # -- Default resources requests and limits for Flyteadmin deployment
  resources:
    limits:
      cpu: 250m
      ephemeral-storage: 100Mi
      memory: 500Mi
    requests:
      cpu: 10m
      ephemeral-storage: 50Mi
      memory: 50Mi
  # -- Default regex string for searching configuration files
  configPath: /etc/flyte/config/*.yaml
  # -- Initial projects to create
  initialProjects:
    - flytesnacks
    - flytetester
    - flyteexamples
  # -- Service settings for Flyteadmin
  service:
    annotations:
      projectcontour.io/upstream-protocol.h2c: grpc
    type: ClusterIP
    loadBalancerSourceRanges: []
    # -- Appends additional ports to the service spec.
    additionalPorts: []
  # -- Configuration for service accounts for FlyteAdmin
  serviceAccount:
    # -- Should a service account be created for flyteadmin
    create: true
    # -- Should a service account always be created for flyteadmin even without an actual flyteadmin deployment running (e.g. for multi-cluster setups)
    alwaysCreate: false
    # -- Annotations for ServiceAccount attached to Flyteadmin pods
    annotations: {}
    # -- ImagePullSecrets to automatically assign to the service account
    imagePullSecrets: []
    # -- Should a ClusterRole be created for Flyteadmin
    createClusterRole: true
    # -- Configuration for ClusterRole created for Flyteadmin
    clusterRole:
      # -- Specifies the API groups that this ClusterRole can access
      apiGroups:
        - ""
        - "flyte.lyft.com"
        - "rbac.authorization.k8s.io"
      # -- Specifies the resources that this ClusterRole can access
      resources:
        - configmaps
        - flyteworkflows
        - namespaces
        - pods
        - resourcequotas
        - roles
        - rolebindings
        - secrets
        - services
        - serviceaccounts
        - spark-role
        - limitranges
      # -- Specifies the verbs (actions) that this ClusterRole can perform on the specified resources
      verbs:
        - "*"
  # -- Annotations for Flyteadmin pods
  podAnnotations: {}
  # -- Labels for Flyteadmin pods
  podLabels: {}
  # -- nodeSelector for Flyteadmin deployment
  nodeSelector: {}
  # -- tolerations for Flyteadmin deployment
  tolerations: []
  # -- affinity for Flyteadmin deployment
  affinity: {}
  secrets: {}
  # -- Appends additional volumes to the deployment spec. May include template values.
  additionalVolumes: []
  # -- Appends additional volume mounts to the main container's spec. May include template values.
  additionalVolumeMounts: []
  # -- Appends additional containers to the deployment spec. May include template values.
  additionalContainers: []
  # -- Appends extra command line arguments to the serve command
  extraArgs: {}
  # -- Sets priorityClassName for flyteadmin pod(s).
  priorityClassName: ""
  # -- Sets securityContext for flyteadmin pod(s).
  securityContext:
    runAsNonRoot: true
    fsGroup: 65534
    runAsUser: 1001
    fsGroupChangePolicy: "Always"
    seLinuxOptions:
      type: spc_t

  # -- Settings for flyteadmin service monitor
  serviceMonitor:
    # -- If enabled create the flyteadmin service monitor
    enabled: false
    # -- Sets the interval at which metrics will be scraped by prometheus
    interval: 60s
    # -- Sets the timeout after which request to scrape metrics will time out
    scrapeTimeout: 30s
    # -- Sets the labels for the service monitor which are required by the
    # prometheus to auto-detect the service monitor and start scrapping the metrics
    labels: {}
#
# FLYTESCHEDULER SETTINGS
#

flytescheduler:
  # -- Whether to inject an init container which waits on flyteadmin
  runPrecheck: true
  image:
    # -- Docker image for Flytescheduler deployment
    repository: cr.flyte.org/flyteorg/flytescheduler  # FLYTESCHEDULER_IMAGE
    # -- Docker image tag
    tag: v1.12.1-rc0  # FLYTESCHEDULER_TAG
    # -- Docker image pull policy
    pullPolicy: IfNotPresent
  # -- Default resources requests and limits for Flytescheduler deployment
  resources:
    limits:
      cpu: 250m
      ephemeral-storage: 100Mi
      memory: 500Mi
    requests:
      cpu: 10m
      ephemeral-storage: 50Mi
      memory: 50Mi
  # -- Default regex string for searching configuration files
  configPath: /etc/flyte/config/*.yaml

  # -- Configuration for service accounts for Flytescheduler
  serviceAccount:
    # -- Should a service account be created for Flytescheduler
    create: true
    # -- Annotations for ServiceAccount attached to Flytescheduler pods
    annotations: {}
    # -- ImagePullSecrets to automatically assign to the service account
    imagePullSecrets: []
  # -- Annotations for Flytescheduler pods
  podAnnotations: {}
  # -- Additional Flytescheduler container environment variables
  podEnv: {}
  # -- Labels for Flytescheduler pods
  podLabels: {}
  # -- nodeSelector for Flytescheduler deployment
  nodeSelector: {}
  # -- tolerations for Flytescheduler deployment
  tolerations: []
  # -- affinity for Flytescheduler deployment
  affinity: {}
  secrets: {}
  # -- Appends additional volumes to the deployment spec. May include template values.
  additionalVolumes: []
  # -- Appends additional volume mounts to the main container's spec. May include template values.
  additionalVolumeMounts: []
  # -- Appends additional containers to the deployment spec. May include template values.
  additionalContainers: []
  # -- Sets priorityClassName for flyte scheduler pod(s).
  priorityClassName: ""
  # -- Sets securityContext for flytescheduler pod(s).
  securityContext:
    runAsNonRoot: true
    fsGroup: 65534
    runAsUser: 1001
    fsGroupChangePolicy: "Always"
    seLinuxOptions:
      type: spc_t

#
# DATACATALOG SETTINGS
#

datacatalog:
  enabled: true
  # -- Replicas count for Datacatalog deployment
  replicaCount: 1
  image:
    # -- Docker image for Datacatalog deployment
    repository: cr.flyte.org/flyteorg/datacatalog  # DATACATALOG_IMAGE
    # -- Docker image tag
    tag: v1.12.1-rc0  # DATACATALOG_TAG
    # -- Docker image pull policy
    pullPolicy: IfNotPresent
  # -- Default resources requests and limits for Datacatalog deployment
  resources:
    limits:
      cpu: 500m
      ephemeral-storage: 100Mi
      memory: 500Mi
    requests:
      cpu: 10m
      ephemeral-storage: 50Mi
      memory: 50Mi
  # -- Default regex string for searching configuration files
  configPath: /etc/datacatalog/config/*.yaml
  # -- Service settings for Datacatalog
  service:
    annotations:
      projectcontour.io/upstream-protocol.h2c: grpc
    type: NodePort
    # -- Appends additional ports to the service spec.
    additionalPorts: []
  # -- Configuration for service accounts for Datacatalog
  serviceAccount:
    # -- Should a service account be created for Datacatalog
    create: true
    # -- Annotations for ServiceAccount attached to Datacatalog pods
    annotations: {}
    # -- ImagePullSecrets to automatically assign to the service account
    imagePullSecrets: []
  # -- Annotations for Datacatalog pods
  podAnnotations: {}
  # -- Additional Datacatalog container environment variables
  podEnv: {}
  # -- Labels for Datacatalog pods
  podLabels: {}
  # -- nodeSelector for Datacatalog deployment
  nodeSelector: {}
  # -- tolerations for Datacatalog deployment
  tolerations: []
  # -- affinity for Datacatalog deployment
  affinity: {}
  # -- Appends additional volumes to the deployment spec. May include template values.
  additionalVolumes: []
  # -- Appends additional volume mounts to the main container's spec. May include template values.
  additionalVolumeMounts: []
  # -- Appends additional containers to the deployment spec. May include template values.
  additionalContainers: []
  # -- Appends extra command line arguments to the main command
  extraArgs: {}
  # -- Sets priorityClassName for datacatalog pod(s).
  priorityClassName: ""
  # -- Sets securityContext for datacatalog pod(s).
  securityContext:
    runAsNonRoot: true
    fsGroup: 1001
    runAsUser: 1001
    fsGroupChangePolicy: "OnRootMismatch"
    seLinuxOptions:
      type: spc_t

#
# FLYTE_AGENT SETTINGS
#

flyteagent:
  enabled: false
  plugin_config:
    plugins:
      # -- Agent service configuration for propeller.
      agent-service:
        # -- The default agent service to use for plugin tasks.
        defaultAgent:
          # -- The agent service endpoint propeller should connect to.
          endpoint: "dns:///flyteagent.flyte.svc.cluster.local:8000"
          # -- Whether the connection from propeller to the agent service should use TLS.
          insecure: true
        # -- The task types supported by the default agent.
        supportedTaskTypes:
        - sensor
        # -- Uncomment to enable task type that uses Flyte Agent
        # - bigquery_query_job_task
  # -- Labels for flyteagent pods
  podLabels: {}

#
# FLYTEPROPELLER SETTINGS
#

flytepropeller:
  enabled: true
  manager: false
  # -- Whether to install the flyteworkflows CRD with helm
  createCRDs: true
  # -- Replicas count for Flytepropeller deployment
  replicaCount: 1
  image:
    # -- Docker image for Flytepropeller deployment
    repository: cr.flyte.org/flyteorg/flytepropeller  # FLYTEPROPELLER_IMAGE
    tag: v1.12.1-rc0  # FLYTEPROPELLER_TAG
    pullPolicy: IfNotPresent
  # -- Default resources requests and limits for Flytepropeller deployment
  resources:
    limits:
      cpu: 200m
      ephemeral-storage: 100Mi
      memory: 200Mi
    requests:
      cpu: 10m
      ephemeral-storage: 50Mi
      memory: 100Mi
  cacheSizeMbs: 0
  # -- Error reporting
  terminationMessagePolicy: FallbackToLogsOnError
  # -- Default regex string for searching configuration files
  configPath: /etc/flyte/config/*.yaml

  # -- Configuration for service accounts for FlytePropeller
  serviceAccount:
    # -- Should a service account be created for FlytePropeller
    create: true
    # -- Annotations for ServiceAccount attached to FlytePropeller pods
    annotations: {}
    # -- ImagePullSecrets to automatically assign to the service account
    imagePullSecrets: []
  # -- Annotations for Flytepropeller pods
  podAnnotations: {}
  # -- Additional Flytepropeller container environment variables
  podEnv: {}
  # -- Labels for Flytepropeller pods
  podLabels: {}
  # -- nodeSelector for Flytepropeller deployment
  nodeSelector: {}
  # -- tolerations for Flytepropeller deployment
  tolerations: []
  # -- affinity for Flytepropeller deployment
  affinity: {}
  # -- Appends additional volumes to the deployment spec. May include template values.
  additionalVolumes: []
  # -- Appends additional volume mounts to the main container's spec. May include template values.
  additionalVolumeMounts: []
  # -- Appends additional containers to the deployment spec. May include template values.
  additionalContainers: []
  # -- Appends extra command line arguments to the main command
  extraArgs: {}
  # -- Defines the cluster name used in events sent to Admin
  clusterName: ""
  # -- Sets priorityClassName for propeller pod(s).
  priorityClassName: ""
  # -- Sets securityContext for flytepropeller pod(s).
  securityContext:
    fsGroup: 65534
    runAsUser: 1001
    fsGroupChangePolicy: "Always"

  # -- Settings for flytepropeller service
  service:
    # -- If enabled create the flytepropeller service
    enabled: false
    # -- Appends additional ports to the service spec.
    additionalPorts: []

  # -- Settings for flytepropeller service monitor
  serviceMonitor:
    # -- If enabled create the flyetepropeller service monitor
    enabled: false
    # -- Sets the labels for the service monitor which are required by the
    # prometheus to auto-detect the service monitor and start scrapping the metrics
    labels: {}
    # -- Sets the interval at which metrics will be scraped by prometheus
    interval: 60s
    # -- Sets the timeout after which request to scrape metrics will time out
    scrapeTimeout: 30s

  prometheus:
    enabled: false
    path: "/metrics"
    port: 10254

#
# FLYTECONSOLE SETTINGS
#

flyteconsole:
  enabled: true
  # -- Replicas count for Flyteconsole deployment
  replicaCount: 1
  image:
    # -- Docker image for Flyteconsole deployment
    repository: cr.flyte.org/flyteorg/flyteconsole  # FLYTECONSOLE_IMAGE
    tag: v1.14.0  # FLYTECONSOLE_TAG
    pullPolicy: IfNotPresent
  # -- Default resources requests and limits for Flyteconsole deployment
  resources:
    limits:
      cpu: 500m
      memory: 250Mi
    requests:
      cpu: 10m
      memory: 50Mi
  # -- Service settings for Flyteconsole
  service:
    annotations: {}
    type: ClusterIP
  # -- Annotations for Flyteconsole pods
  podAnnotations: {}
  # -- Additional Flyteconsole container environment variables
  podEnv: {}
  # -- Labels for Flyteconsole pods
  podLabels: {}
  # -- nodeSelector for Flyteconsole deployment
  nodeSelector: {}
  # -- tolerations for Flyteconsole deployment
  tolerations: []
  # -- affinity for Flyteconsole deployment
  affinity: {}
  # Enable Google Analytics
  ga:
    enabled: false
    tracking_id: "G-0QW4DJWJ20"
  # -- Sets priorityClassName for flyte console pod(s).
  priorityClassName: ""
   # -- ImagePullSecrets to assign to the Flyteconsole deployment
  imagePullSecrets: []
  # -- Sets securityContext for flyteconsole pod(s).
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    fsGroupChangePolicy: "OnRootMismatch"
    seLinuxOptions:
      type: spc_t

  # -- Settings for flyteconsole service monitor
  serviceMonitor:
    # -- If enabled create the flyteconsole service monitor
    enabled: false
    # -- Sets the interval at which metrics will be scraped by prometheus
    interval: 60s
    # -- Sets the timeout after which request to scrape metrics will time out
    scrapeTimeout: 30s
    # -- Sets the labels for the service monitor which are required by the
    # prometheus to auto-detect the service monitor and start scrapping the metrics
    labels: {}

  livenessProbe: {}
  readinessProbe: {}

# It will enable the redoc route in ingress
deployRedoc: false

#
# Common secret auth for propeller & scheduler
#

secrets:
  adminOauthClientCredentials:
    # If enabled is true, and `clientSecret` is specified, helm will create and mount `flyte-secret-auth`.
    # If enabled is true, and `clientSecret` is null, it's up to the user to create `flyte-secret-auth` as described in
    # https://docs.flyte.org/en/latest/deployment/cluster_config/auth_setup.html#oauth2-authorization-server
    # and helm will mount `flyte-secret-auth`.
    # If enabled is false, auth is not turned on.
    # Note: Unsupported combination: enabled.false and clientSecret.someValue
    enabled: true
    clientSecret: foobar
    clientId: flytepropeller

#
# WEBHOOK SETTINGS
#

webhook:
  # -- enable or disable secrets webhook
  enabled: true
  # -- Sets priorityClassName for webhook pod
  priorityClassName: ""
  # -- Configuration for service accounts for the webhook
  serviceAccount:
    # -- Should a service account be created for the webhook
    create: true
    # -- Annotations for ServiceAccount attached to the webhook
    annotations: {}
    # -- ImagePullSecrets to automatically assign to the service account
    imagePullSecrets: []
  # -- Service settings for the webhook
  service:
    annotations:
      projectcontour.io/upstream-protocol.h2c: grpc
    type: ClusterIP
  # -- Sets securityContext for webhook pod(s).
  securityContext:
    fsGroup: 65534
    runAsNonRoot: true
    runAsUser: 1001
    fsGroupChangePolicy: "Always"
    seLinuxOptions:
      type: spc_t

  resources:
    requests:
      cpu: 200m
      ephemeral-storage: 500Mi
      memory: 500Mi

  autoscaling:
    enabled: false
    minReplicas: 1
    maxReplicas: 10
    metrics:
      - type: Resource
        resource:
          name: cpu
          target:
            type: Utilization
            averageUtilization: 80
      - type: Resource
        resource:
          name: memory
          target:
            type: Utilization
            averageUtilization: 80

  prometheus:
    enabled: false
    path: "/metrics"
    port: 10254

# ------------------------------------------------
#
# COMMON SETTINGS
#

common:
  databaseSecret:
    # -- Specify name of K8s Secret which contains Database password. Leave it empty if you don't need this Secret
    name: ""
    # -- Specify your Secret (with sensitive data) or pseudo-manifest (without sensitive data). See https://github.com/godaddy/kubernetes-external-secrets
    secretManifest: {}
  ingress:
    # --- Sets the ingressClassName
    ingressClassName:
    # --- Enable or disable creating Ingress for Flyte. Relevant to disable when using e.g. Istio as ingress controller.
    enabled: true
    # --- Enable or disable HMR route to flyteconsole. This is useful only for frontend development.
    webpackHMR: false
    # --- separateGrpcIngress puts GRPC routes into a separate ingress if true. Required for certain ingress controllers like nginx.
    separateGrpcIngress: false
    # --- Extra Ingress annotations applied only to the GRPC ingress. Only makes sense if `separateGrpcIngress` is enabled.
    separateGrpcIngressAnnotations:
      nginx.ingress.kubernetes.io/backend-protocol: "GRPC"
    # --- Ingress annotations applied to both HTTP and GRPC ingresses.
    annotations:
      nginx.ingress.kubernetes.io/app-root: /console
    # --- albSSLRedirect adds a special route for ssl redirect. Only useful in combination with the AWS LoadBalancer Controller.
    albSSLRedirect: false
    # --- Ingress hostname
    # host:
    tls:
      enabled: false
      # --- Override default secret containing the tls certificate
      # secretName:
  flyteNamespaceTemplate:
    # --- Enable or disable creating Flyte namespace in template. Enable when using helm as template-engine only. Disable when using `helm install ...`.
    enabled: false

# -----------------------------------------------------
# Core dependencies that should be configured for Flyte to work on any platform
# Specifically 2 - Storage (s3, gcs etc), Production RDBMS - Aurora, CloudSQL etc
# ------------------------------------------------------
#
# STORAGE SETTINGS
#

storage:
  # -- Sets the storage type. Supported values are sandbox, s3, gcs and custom.
  type: sandbox
  # -- bucketName defines the storage bucket flyte will use. Required for all types except for sandbox.
  bucketName: my-s3-bucket
  # -- settings for storage type s3
  s3:
    region: us-east-1
    # -- type of authentication to use for S3 buckets, can either be iam or accesskey
    authType: iam
    # -- AWS IAM user access key ID to use for S3 bucket auth, only used if authType is set to accesskey
    accessKey: ""
    # -- AWS IAM user secret access key to use for S3 bucket auth, only used if authType is set to accesskey
    secretKey: ""
  # -- settings for storage type gcs
  gcs:
  # -- GCP project ID. Required for storage type gcs.
  # projectId:
  # -- Settings for storage type custom. See https://github.com/graymeta/stow for supported storage providers/settings.
  custom: {}
  # -- toggles multi-container storage config
  enableMultiContainer: false
  # -- default limits being applied to storage config
  limits:
    maxDownloadMBs: 10

# Database configuration
db:
  datacatalog:
    database:
      port: 5432
      username: postgres
      host: postgres
      dbname: "datacatalog"
  admin:
    database:
      port: 5432
      username: postgres
      host: postgres
      dbname: "flyteadmin"
# --------------------------------------------------------------------
# Specializing your deployment using configuration
# -------------------------------------------------------------------
#
# CONFIGMAPS SETTINGS
#

configmap:
  clusters:
    labelClusterMap: {}
    #  labelClusterMap:
    #    team1:
    #      - id: testcluster
    #        weight: 1
    #    team2:
    #      - id: testcluster2
    #        weight: 0.5
    #      - id: testcluster3
    #        weight: 0.5
    clusterConfigs: []
  #  clusterConfigs:
  #    - name: "testcluster"
  #      endpoint: "testcluster_endpoint"
  #      auth:
  #        type: "file_path"
  #        tokenPath: "/path/to/testcluster/token"
  #        certPath: "/path/to/testcluster/cert"
  #    - name: "testcluster2"
  #      endpoint: "testcluster2_endpoint"
  #      enabled: true
  #      auth:
  #        type: "file_path"
  #        tokenPath: "/path/to/testcluster2/token"
  #        certPath: "/path/to/testcluster2/cert"
  #    - name: "testcluster3"
  #      endpoint: "testcluster3_endpoint"
  #      enabled: true
  #      auth:
  #        type: "file_path"
  #        tokenPath: "/path/to/testcluster3/token"
  #        certPath: "/path/to/testcluster3/cert"

  # -- Configuration for Flyte console UI
  console:
    BASE_URL: /console
    CONFIG_DIR: /etc/flyte/config

  # -- Domains configuration for Flyte projects. This enables the specified number of domains across all projects in Flyte.
  domain:
    domains:
      - id: development
        name: development
      - id: staging
        name: staging
      - id: production
        name: production

  # Refer to the full [structure](https://pkg.go.dev/github.com/lyft/flyteadmin@v0.3.37/pkg/runtime/interfaces#ApplicationConfig) for documentation.
  schedulerConfig:
    scheduler:
      metricsScope: "flyte:"
      profilerPort: 10254

  # -- FlyteAdmin server configuration
  adminServer:
    # Refer to the [server config](https://pkg.go.dev/github.com/lyft/flyteadmin@v0.3.37/pkg/config#ServerConfig).
    server:
      httpPort: 8088
      grpc:
        port: 8089
      security:
        # -- Controls whether to serve requests over SSL/TLS.
        secure: false
        # -- Controls whether to enforce authentication. Follow the guide in https://docs.flyte.org/ on how to setup authentication.
        useAuth: false
        allowCors: true
        allowedOrigins:
          # Accepting all domains for Sandbox installation
          - "*"
        allowedHeaders:
          - "Content-Type"
          - "flyte-authorization"
    # Refer to the full [structure](https://pkg.go.dev/github.com/lyft/flyteadmin@v0.3.37/pkg/runtime/interfaces#ApplicationConfig) for documentation.
    flyteadmin:
      roleNameKey: "iam.amazonaws.com/role"
      profilerPort: 10254
      metricsScope: "flyte:"
      metadataStoragePrefix:
        - "metadata"
        - "admin"
      eventVersion: 2
      testing:
        host: http://flyteadmin

    # -- Authentication configuration
    auth:
      authorizedUris:
        # This should point at your public http Uri.
        - https://localhost:30081
        # This will be used by internal services in the same namespace as flyteadmin
        - http://flyteadmin:80
        # This will be used by internal services in the same cluster but different namespaces
        - http://flyteadmin.flyte.svc.cluster.local:80

      # Controls app authentication config
      appAuth:
        thirdPartyConfig:
          flyteClient:
            clientId: flytectl
            redirectUri: http://localhost:53593/callback
            scopes:
              - offline
              - all
      # Controls user authentication
      userAuth:
        openId:
          baseUrl: https://accounts.google.com
          scopes:
            - profile
            - openid
          clientId: 657465813211-6eog7ek7li5k7i7fvgv2921075063hpe.apps.googleusercontent.com

  # -- Datacatalog server config
  datacatalogServer:
    datacatalog:
      storage-prefix: metadata/datacatalog
      metrics-scope: datacatalog
      profiler-port: 10254
      heartbeat-grace-period-multiplier: 3
      max-reservation-heartbeat: 30s
    application:
      grpcPort: 8089
      httpPort: 8080
      grpcServerReflection: true

  # -- Task default resources configuration
  # Refer to the full [structure](https://pkg.go.dev/github.com/lyft/flyteadmin@v0.3.37/pkg/runtime/interfaces#TaskResourceConfiguration).
  task_resource_defaults:
    # -- Task default resources parameters
    task_resources:
      defaults:
        cpu: 100m
        memory: 500Mi
      limits:
        cpu: 2
        memory: 1Gi
        gpu: 1

  # -- Admin Client configuration [structure](https://pkg.go.dev/github.com/flyteorg/flytepropeller/pkg/controller/nodes/subworkflow/launchplan#AdminConfig)
  admin:
    event:
      type: admin
      rate: 500
      capacity: 1000
    admin:
      endpoint: flyteadmin:81
      insecure: true
      clientId: "{{ .Values.secrets.adminOauthClientCredentials.clientId }}"
      clientSecretLocation: /etc/secrets/client_secret
  # -- Catalog Client configuration [structure](https://pkg.go.dev/github.com/flyteorg/flytepropeller/pkg/controller/nodes/task/catalog#Config)
  # Additional advanced Catalog configuration [here](https://pkg.go.dev/github.com/lyft/flyteplugins/go/tasks/pluginmachinery/catalog#Config)
  catalog:
    catalog-cache:
      endpoint: datacatalog:89
      type: datacatalog
      insecure: true

  # -- Copilot configuration
  copilot:
    plugins:
      k8s:
        # -- Structure documented [here](https://pkg.go.dev/github.com/lyft/flyteplugins@v0.5.28/go/tasks/pluginmachinery/flytek8s/config#FlyteCoPilotConfig)
        co-pilot:
          name: flyte-copilot-
          image: cr.flyte.org/flyteorg/flytecopilot:v1.12.1-rc0  # FLYTECOPILOT_IMAGE
          start-timeout: 30s

  # -- Core propeller configuration
  core:
    # -- follows the structure specified [here](https://pkg.go.dev/github.com/flyteorg/flytepropeller/manager/config#Config).
    manager:
      pod-application: "flytepropeller"
      pod-template-container-name: "flytepropeller"
      pod-template-name: "flytepropeller-template"
    # -- follows the structure specified [here](https://pkg.go.dev/github.com/flyteorg/flytepropeller/pkg/controller/config).
    propeller:
      rawoutput-prefix: s3://my-s3-bucket/
      metadata-prefix: metadata/propeller
      workers: 4
      max-workflow-retries: 30
      workflow-reeval-duration: 30s
      downstream-eval-duration: 30s
      limit-namespace: "all"
      prof-port: 10254
      metrics-prefix: flyte
      enable-admin-launcher: true
      leader-election:
        lock-config-map:
          name: propeller-leader
          namespace: flyte
        enabled: true
        lease-duration: 15s
        renew-deadline: 10s
        retry-period: 2s
      queue:
        type: batch
        batching-interval: 2s
        batch-size: -1
        queue:
          type: maxof
          rate: 100
          capacity: 1000
          base-delay: 5s
          max-delay: 120s
        sub-queue:
          type: bucket
          rate: 10
          capacity: 100
    webhook:
      certDir: /etc/webhook/certs
      serviceName: flyte-pod-webhook
    # -- For Workflow store use configuration [here](https://pkg.go.dev/github.com/flyteorg/flytepropeller/pkg/controller/workflowstore#Config)
    #

  enabled_plugins:
    # -- Tasks specific configuration [structure](https://pkg.go.dev/github.com/flyteorg/flytepropeller/pkg/controller/nodes/task/config#GetConfig)
    tasks:
      # -- Plugins configuration, [structure](https://pkg.go.dev/github.com/flyteorg/flytepropeller/pkg/controller/nodes/task/config#TaskPluginConfig)
      task-plugins:
        # -- [Enabled Plugins](https://pkg.go.dev/github.com/lyft/flyteplugins/go/tasks/config#Config). Enable sagemaker*, athena if you install the backend
        # plugins
        enabled-plugins:
          - container
          - sidecar
          - k8s-array
          - agent-service
        default-for-task-types:
          container: container
          sidecar: sidecar
          container_array: k8s-array
          # -- Uncomment to enable task type that uses Flyte Agent
          # bigquery_query_job_task: agent-service

  # -- Kubernetes specific Flyte configuration
  k8s:
    plugins:
      # -- Configuration section for all K8s specific plugins [Configuration structure](https://pkg.go.dev/github.com/lyft/flyteplugins/go/tasks/pluginmachinery/flytek8s/config)
      k8s:
        default-env-vars: []
        #  DEFAULT_ENV_VAR: VALUE
        default-cpus: 100m
        default-memory: 100Mi
  remoteData:
    remoteData:
      region: "us-east-1"
      scheme: "local"
      signedUrls:
        durationMinutes: 3

  # -- Resource manager configuration
  resource_manager:
    # -- resource manager configuration
    propeller:
      resourcemanager:
        type: noop

  # -- Section that configures how the Task logs are displayed on the UI. This has to be changed based on your actual logging provider.
  # Refer to [structure](https://pkg.go.dev/github.com/lyft/flyteplugins/go/tasks/logs#LogConfig) to understand how to configure various
  # logging engines
  task_logs:
    plugins:
      logs:
        kubernetes-enabled: false
        # -- One option is to enable cloudwatch logging for EKS, update the region and log group accordingly
        cloudwatch-enabled: false

# ----------------------------------------------------------------
# Optional Modules
# Flyte built extensions that enable various additional features in Flyte.
# All these features are optional, but are critical to run certain features
# ------------------------------------------------------------------------

# -- **Optional Component**
# Flyte uses a cloud hosted Cron scheduler to run workflows on a schedule. The following module is optional. Without,
# this module, you will not have scheduled launchplans / workflows.
# Docs: https://docs.flyte.org/en/latest/howto/enable_and_use_schedules.html#setting-up-scheduled-workflows
workflow_scheduler:
  enabled: false
  config: {}
  type: ""

# -- **Optional Component**
# Workflow notifications module is an optional dependency. Flyte uses cloud native pub-sub systems to notify users of
# various events in their workflows
workflow_notifications:
  enabled: false
  config: {}

# -- **Optional Component**
# External events are used to send events (unprocessed, as Admin see them) to
# an SNS topic (or gcp equivalent)
# The config is here as an example only - if not enabled, it won't be used.
external_events:
  enable: false
  type: aws
  aws:
    region: us-east-2
  eventsPublisher:
    # Make sure this is not a fifo queue. Admin does not yet support
    # writing to fifo sns topics.
    topicName: "arn:aws:sns:us-east-2:123456:123-my-topic"
    eventTypes:
      - all  # Or workflow, node, task. Or "*"

# Cloud events are used to send events (unprocessed, as Admin see them) in cloud event format to
# an SNS topic (or gcp equivalent)
cloud_events:
  enable: false
  type: aws
  aws:
    region: us-east-2
  eventsPublisher:
    # Make sure this is not a fifo queue. Admin does not yet support
    # writing to fifo sns topics.
    topicName: "arn:aws:sns:us-east-2:123456:123-my-topic"
    eventTypes:
      - all  # Or workflow, node, task. Or "*"

# -- Configuration for the Cluster resource manager component. This is an optional component, that enables automatic
# cluster configuration. This is useful to set default quotas, manage namespaces etc that map to a project/domain
cluster_resource_manager:
  # -- Enables the Cluster resource manager component
  enabled: true
  standaloneDeployment: false
  # -- Service account name to run with
  service_account_name: flyteadmin
  # -- Annotations for ClusterResource pods
  podAnnotations: {}
  # -- Additional ClusterResource container environment variables
  podEnv: {}
  # -- Labels for ClusterResource pods
  podLabels: {}
  # -- nodeSelector for ClusterResource deployment
  nodeSelector: {}
  # -- Resources for ClusterResource deployment
  resources: {}
  # -- Configmap for ClusterResource parameters
  config:
    # -- ClusterResource parameters
    # Refer to the [structure](https://pkg.go.dev/github.com/lyft/flyteadmin@v0.3.37/pkg/runtime/interfaces#ClusterResourceConfig) to customize.
    cluster_resources:
      # -- How frequently to run the sync process
      refreshInterval: 5m
      templatePath: "/etc/flyte/clusterresource/templates"
      # -- Starts the cluster resource manager in standalone mode with requisite auth credentials to call flyteadmin service endpoints
      standaloneDeployment: false
      customData:
        - production:
            - projectQuotaCpu:
                value: "5"
            - projectQuotaMemory:
                value: "4000Mi"
        - staging:
            - projectQuotaCpu:
                value: "2"
            - projectQuotaMemory:
                value: "3000Mi"
        - development:
            - projectQuotaCpu:
                value: "4"
            - projectQuotaMemory:
                value: "3000Mi"

  prometheus:
    enabled: false
    path: "/metrics"
    port: 10254

  # -- Resource templates that should be applied
  templates:
    # -- Template for namespaces resources
    - key: aa_namespace
      value: |
        apiVersion: v1
        kind: Namespace
        metadata:
          name: {{ namespace }}
        spec:
          finalizers:
          - kubernetes

    - key: ab_project_resource_quota
      value: |
        apiVersion: v1
        kind: ResourceQuota
        metadata:
          name: project-quota
          namespace: {{ namespace }}
        spec:
          hard:
            limits.cpu: {{ projectQuotaCpu }}
            limits.memory: {{ projectQuotaMemory }}

# --------------------------------------------------------
# Optional Plugins
# --------------------------------------------------------

# -- Optional: Spark Plugin using the Spark Operator
sparkoperator:
  # --- enable or disable Sparkoperator deployment installation
  enabled: false

  # -- Spark plugin configuration
  plugin_config:
    plugins:
      spark:
        # -- Spark default configuration
        spark-config-default:
          # We override the default credentials chain provider for Hadoop so that
          # it can use the serviceAccount based IAM role or ec2 metadata based.
          # This is more in line with how AWS works
          - spark.hadoop.fs.s3a.aws.credentials.provider: "com.amazonaws.auth.DefaultAWSCredentialsProviderChain"
          - spark.hadoop.mapreduce.fileoutputcommitter.algorithm.version: "2"
          - spark.kubernetes.allocation.batch.size: "50"
          - spark.hadoop.fs.s3a.acl.default: "BucketOwnerFullControl"
          - spark.hadoop.fs.s3n.impl: "org.apache.hadoop.fs.s3a.S3AFileSystem"
          - spark.hadoop.fs.AbstractFileSystem.s3n.impl: "org.apache.hadoop.fs.s3a.S3A"
          - spark.hadoop.fs.s3.impl: "org.apache.hadoop.fs.s3a.S3AFileSystem"
          - spark.hadoop.fs.AbstractFileSystem.s3.impl: "org.apache.hadoop.fs.s3a.S3A"
          - spark.hadoop.fs.s3a.impl: "org.apache.hadoop.fs.s3a.S3AFileSystem"
          - spark.hadoop.fs.AbstractFileSystem.s3a.impl: "org.apache.hadoop.fs.s3a.S3A"
          - spark.hadoop.fs.s3a.multipart.threshold: "536870912"
          - spark.blacklist.enabled: "true"
          - spark.blacklist.timeout: "5m"
          - spark.task.maxfailures: "8"

# -- Optional: Dask Plugin using the Dask Operator
daskoperator:
  # --- enable or disable the dask operator deployment installation
  enabled: false

# -- Optional: Databricks Plugin allows us to run the spark job on the Databricks platform.
databricks:
  enabled: false
  plugin_config:
    plugins:
      databricks:
        entrypointFile: dbfs:///FileStore/tables/entrypoint.py
        # Databricks account
        databricksInstance: dbc-a53b7a3c-614c
